<?php
$sora_ar = array('القرآن الكريم','الفاتحة','البقرة','آل عمران','النساء','المائدة','الأنعام','الأعراف','الأنفال','التوبة','يونس','هود','يوسف','الرعد','إبراهيم','الحجر','النحل','الإسراء','الكهف','مريم','طه','الأنبياء','الحج','المؤمنون','النور','الفرقان','الشعراء','النمل','القصص','العنكبوت','الروم','لقمان','السجدة','الأحزاب','سبأ','فاطر','يس','الصافات','ص','الزمر','غافر','فصلت','الشورى','الزخرف','الدخان','الجاثية','الأحقاف','محمد','الفتح','الحجرات','ق','الذاريات','الطور','النجم','القمر','الرحمن','الواقعة','الحديد','المجادلة','الحشر','الممتحنة','الصف','الجمعة','المنافقون','التغابن','الطلاق','التحريم','الملك','القلم','الحاقة','المعارج','نوح','الجن','المزمل','المدثر','القيامة','الإنسان','المرسلات','النبأ','النازعات','عبس','التكوير','الانفطار','المطففين','الانشقاق','البروج','الطارق','الأعلى','الغاشية','الفجر','البلد','الشمس','الليل','الضحى','الشرح','التين','العلق','القدر','البينة','الزلزلة','العاديات','القارعة','التكاثر','العصر','الهمزة','الفيل','قريش','الماعون','الكوثر','الكافرون','النصر','المسد','الإخلاص','الفلق','الناس');
$sora_en = array('Quran','Al-Fatihah ( The Opening )','Al-Baqarah ( The Cow )','Al-Imran ( The Famiy of Imran )','An-Nisa ( The Women )','Al-Maidah ( The Table spread with Food )','Al-An\'am ( The Cattle )','Al-A\'raf (The Heights )','Al-Anfal ( The Spoils of War )','At-Taubah ( The Repentance )','Yunus ( Jonah )','Hud','Yusuf (Joseph )','Ar-Ra\'d ( The Thunder )','Ibrahim ( Abraham )','Al-Hijr ( The Rocky Tract )','An-Nahl ( The Bees )','Al-Isra ( The Night Journey )','Al-Kahf ( The Cave )','Maryam ( Mary )','Taha','Al-Anbiya ( The Prophets )','Al-Hajj ( The Pilgrimage )','Al-Mu\'minoon ( The Believers )','An-Noor ( The Light )','Al-Furqan (The Criterion )','Ash-Shuara ( The Poets )','An-Naml (The Ants )','Al-Qasas ( The Stories )','Al-Ankaboot ( The Spider )','Ar-Room ( The Romans )','Luqman','As-Sajdah ( The Prostration )','Al-Ahzab ( The Combined Forces )','Saba ( Sheba )','Fatir ( The Orignator )','Ya-seen','As-Saaffat ( Those Ranges in Ranks )','Sad ( The Letter Sad )','Az-Zumar ( The Groups )','Ghafir ( The Forgiver God )','Fussilat ( Explained in Detail )','Ash-Shura (Consultation )','Az-Zukhruf ( The Gold Adornment )','Ad-Dukhan ( The Smoke )','Al-Jathiya ( Crouching )','Al-Ahqaf ( The Curved Sand-hills )','Muhammad','Al-Fath ( The Victory )','Al-Hujurat ( The Dwellings )','Qaf ( The Letter Qaf )','Adh-Dhariyat ( The Wind that Scatter )','At-Tur ( The Mount )','An-Najm ( The Star )','Al-Qamar ( The Moon )','Ar-Rahman ( The Most Graciouse )','Al-Waqi\'ah ( The Event )','Al-Hadid ( The Iron )','Al-Mujadilah ( She That Disputeth )','Al-Hashr ( The Gathering )','Al-Mumtahanah ( The Woman to be examined )','As-Saff ( The Row )','Al-Jumu\'ah ( Friday )','Al-Munafiqoon ( The Hypocrites )','At-Taghabun ( Mutual Loss &amp; Gain )','At-Talaq ( The Divorce )','At-Tahrim ( The Prohibition )','Al-Mulk ( Dominion )','Al-Qalam ( The Pen )','Al-Haaqqah ( The Inevitable )','Al-Ma\'arij (The Ways of Ascent )','Nooh','Al-Jinn ( The Jinn )','Al-Muzzammil (The One wrapped in Garments)','Al-Muddaththir ( The One Enveloped )','Al-Qiyamah ( The Resurrection )','Al-Insan ( Man )','Al-Mursalat ( Those sent forth )','An-Naba\' ( The Great News )','An-Nazi\'at ( Those who Pull Out )','Abasa ( He frowned )','At-Takwir ( The Overthrowing )','Al-Infitar ( The Cleaving )','Al-Mutaffifin (Those Who Deal in Fraud)','Al-Inshiqaq (The Splitting Asunder)','Al-Burooj ( The Big Stars )','At-Tariq ( The Night-Comer )','Al-A\'la ( The Most High )','Al-Ghashiya ( The Overwhelming )','Al-Fajr ( The Dawn )','Al-Balad ( The City )','Ash-Shams ( The Sun )','Al-Layl ( The Night )','Ad-Dhuha ( The Forenoon )','As-Sharh ( The Opening Forth)','At-Tin ( The Fig )','Al-\'alaq ( The Clot )','Al-Qadr ( The Night of Decree )','Al-Bayyinah ( The Clear Evidence )','Az-Zalzalah ( The Earthquake )','Al-\'adiyat ( Those That Run )','Al-Qari\'ah ( The Striking Hour )','At-Takathur ( The piling Up )','Al-Asr ( The Time )','Al-Humazah ( The Slanderer )','Al-Fil ( The Elephant )','Quraish','Al-Ma\'un ( Small Kindnesses )','Al-Kauther ( A River in Paradise)','Al-Kafiroon ( The Disbelievers )','An-Nasr ( The Help )','Al-Masad ( The Palm Fibre )','Al-Ikhlas ( Sincerity )','Al-Falaq ( The Daybreak )','An-Nas ( Mankind )');
$colors = array('#F44336', '#FFEBEE', '#FFCDD2', '#EF9A9A', '#E57373', '#EF5350', '#F44336', '#E53935', '#D32F2F', '#C62828', '#B71C1C', '#FF8A80', '#FF5252', '#FF1744', '#D50000', '#E91E63', '#FCE4EC', '#F8BBD0', '#F48FB1', '#F06292', '#EC407A', '#E91E63', '#D81B60', '#C2185B', '#AD1457', '#880E4F', '#FF80AB', '#FF4081', '#F50057', '#C51162', '#9C27B0', '#F3E5F5', '#E1BEE7', '#CE93D8', '#BA68C8', '#AB47BC', '#9C27B0', '#8E24AA', '#7B1FA2', '#6A1B9A', '#4A148C', '#EA80FC', '#E040FB', '#D500F9', '#AA00FF', '#673AB7', '#EDE7F6', '#D1C4E9', '#B39DDB', '#9575CD', '#7E57C2', '#673AB7', '#5E35B1', '#512DA8', '#4527A0', '#311B92', '#B388FF', '#7C4DFF', '#651FFF', '#6200EA', '#3F51B5', '#E8EAF6', '#C5CAE9', '#9FA8DA', '#7986CB', '#5C6BC0', '#3F51B5', '#3949AB', '#303F9F', '#283593', '#1A237E', '#8C9EFF', '#536DFE', '#3D5AFE', '#304FFE', '#2196F3', '#E3F2FD', '#BBDEFB', '#90CAF9', '#64B5F6', '#42A5F5', '#2196F3', '#1E88E5', '#1976D2', '#1565C0', '#0D47A1', '#82B1FF', '#448AFF', '#2979FF', '#2962FF', '#03A9F4', '#E1F5FE', '#B3E5FC', '#81D4FA', '#4FC3F7', '#29B6F6', '#03A9F4', '#039BE5', '#0288D1', '#0277BD', '#01579B', '#80D8FF', '#40C4FF', '#00B0FF', '#0091EA', '#00BCD4', '#E0F7FA', '#B2EBF2', '#80DEEA', '#4DD0E1', '#26C6DA', '#00BCD4', '#00ACC1', '#0097A7', '#00838F', '#006064', '#84FFFF', '#18FFFF', '#00E5FF', '#00B8D4', '#009688', '#E0F2F1', '#B2DFDB', '#80CBC4', '#4DB6AC', '#26A69A', '#009688', '#00897B', '#00796B', '#00695C', '#004D40', '#A7FFEB', '#64FFDA', '#1DE9B6', '#00BFA5', '#4CAF50', '#E8F5E9', '#C8E6C9', '#A5D6A7', '#81C784', '#66BB6A', '#4CAF50', '#43A047', '#388E3C', '#2E7D32', '#1B5E20', '#B9F6CA', '#69F0AE', '#00E676', '#00C853', '#8BC34A', '#F1F8E9', '#DCEDC8', '#C5E1A5', '#AED581', '#9CCC65', '#8BC34A', '#7CB342', '#689F38', '#558B2F', '#33691E', '#CCFF90', '#B2FF59', '#76FF03', '#64DD17', '#CDDC39', '#F9FBE7', '#F0F4C3', '#E6EE9C', '#DCE775', '#D4E157', '#CDDC39', '#C0CA33', '#AFB42B', '#9E9D24', '#827717', '#F4FF81', '#EEFF41', '#C6FF00', '#AEEA00', '#FFEB3B', '#FFFDE7', '#FFF9C4', '#FFF59D', '#FFF176', '#FFEE58', '#FFEB3B', '#FDD835', '#FBC02D', '#F9A825', '#F57F17', '#FFFF8D', '#FFFF00', '#FFEA00', '#FFD600', '#FFC107', '#FFF8E1', '#FFECB3', '#FFE082', '#FFD54F', '#FFCA28', '#FFC107', '#FFB300', '#FFA000', '#FF8F00', '#FF6F00', '#FFE57F', '#FFD740', '#FFC400', '#FFAB00', '#FF9800', '#FFF3E0', '#FFE0B2', '#FFCC80', '#FFB74D', '#FFA726', '#FF9800', '#FB8C00', '#F57C00', '#EF6C00', '#E65100', '#FFD180', '#FFAB40', '#FF9100', '#FF6D00', '#FF5722', '#FBE9E7', '#FFCCBC', '#FFAB91', '#FF8A65', '#FF7043', '#FF5722', '#F4511E', '#E64A19', '#D84315', '#BF360C', '#FF9E80', '#FF6E40', '#FF3D00', '#DD2C00', '#795548', '#EFEBE9', '#D7CCC8', '#BCAAA4', '#A1887F', '#8D6E63', '#795548', '#6D4C41', '#5D4037', '#4E342E', '#3E2723', '#9E9E9E', '#FAFAFA', '#F5F5F5', '#EEEEEE', '#E0E0E0', '#BDBDBD', '#9E9E9E', '#757575', '#616161', '#424242', '#212121', '#607D8B', '#ECEFF1', '#CFD8DC', '#B0BEC5', '#90A4AE', '#78909C', '#607D8B', '#546E7A', '#455A64', '#37474F', '#263238', '#000000', '#FFFFFF');
$ar_mp3_files = 'http://www.qurantranslations.net/sound/versebyversequran/Arabic_Alafasy';
$en_mp3_files = 'http://www.qurantranslations.net/sound/versebyversequran/English_Translated_by_Sahih_International_Recited_by_Ibrahim_Walk';

class Quran_Gateway_Widget extends WP_Widget {

	function __construct() {
		parent::__construct(
			'Quran_Gateway_Widget', // Base ID
			__('Quran Gateway', 'quran_gateway_widget'), // Name
			array( 'description' => __( 'Easily added to Widget and updated randomly', 'quran_gateway_widget' ), ) // Args
		);
	}

	public function widget( $args, $instance ) {
		global $QURAN, $TRANSLATE, $sora_ar, $sora_en, $ar_mp3_files, $en_mp3_files;

		$title = apply_filters( 'widget_title', $instance['title'] );
		$quran_random_id = $instance['quran_random_id'];
		$quran_random_view_ar = $instance['quran_random_view_ar'];
		$quran_random_allow_by_sora = $instance['quran_random_allow_by_sora'];
		$quran_random_by_sora = $instance['quran_random_by_sora'];
		
		if($quran_random_id == 1){ 
		include_once('files/English_Sahih_International.php');
		}elseif($quran_random_id == 2){
		include_once('files/French.php');
		}else{
		include_once('files/English_Sahih_International.php');
		}
		
		if($quran_random_allow_by_sora==1){
		$random_sora = $quran_random_by_sora;
		$random_aya = rand(1, count($QURAN[$random_sora]));
		}else{
		$random_sora = rand(1, 114);
		$random_aya = rand(1, count($QURAN[$random_sora]));
		}
		
		$sora_number = strlen($random_sora);
		$aya_number = strlen($random_aya);

		if($sora_number==1){
			$s = '00'.$random_sora;
		}elseif($sora_number==2){
			$s = '0'.$random_sora;
		}elseif($sora_number==3){
			$s = $random_sora;
		}

		if($aya_number==1){
			$a = '00'.$random_aya;
		}elseif($aya_number==2){
			$a = '0'.$random_aya;
		}elseif($aya_number==3){
			$a = $random_aya;
		}

		$sound_file_ar = ''.$ar_mp3_files.'/'.$s.''.$a.'.mp3';

		if($quran_random_id == 1){
		$sound_file = ''.$en_mp3_files.'/'.$s.''.$a.'.mp3';
		$sound_file_en = ' onclick="changesound(\''.$sound_file.'\');"';
		$listen = '<img onclick="changesound(\''.$sound_file.'\');" src="'.trailingslashit(plugins_url(null,__FILE__)).'/i/listen.png" alt="Listen" />';
		}else{
		$sound_file_en = '';
		$listen = '';
		}
		
		$code = "<script>
  function changesound(ID) {
    var sound_id = document.getElementById(\"quran_sound\");
    if(ID == 0){
    sound_id.innerHTML = '';
    }else{
    sound_id.innerHTML = '<div style=\"margin-top:15px;\"><audio controls autoplay><source src=\"'+ID+'\" type=\"audio/mpeg\">Your browser does not support the audio element.</audio><br /><a href=\"'+ID+'\">Download this file</a></div>';
    }
  }
</script>";
		$code .= '<div class="quran_gateway_widget">';
		if($quran_random_view_ar == 1){
		$code .= '<div class="aya_ar" onclick="changesound(\''.$sound_file_ar.'\');">'.$QURAN[$random_sora][$random_aya].' <span class="sora_name">['.$random_aya.'] '.$sora_ar[$random_sora].'</span> <img onclick="changesound(\''.$sound_file_ar.'\');" src="'.trailingslashit(plugins_url(null,__FILE__)).'/i/listen_ar.png" alt="Listen" /></div>';
		}
		$code .= '<div class="aya_en"'.$sound_file_en.'>'.$TRANSLATE[$random_sora][$random_aya].' <span class="sora_name">['.$random_aya.'] '.$sora_en[$random_sora].'</span> '.$listen.'</div>';
		
		$code .= '<div id="quran_sound"></div>';
		$code .= '</div>';

		echo $args['before_widget'];
		if ( ! empty( $title ) )
			echo $args['before_title'] . $title . $args['after_title'];
		echo __( ''.$code.'', 'quran_gateway_widget' );
		echo $args['after_widget'];
	}

	public function form( $instance ) {
		global $sora_en;
		if ( isset( $instance[ 'title' ] ) ) {
			$title = $instance[ 'title' ];
			$quran_random_id = $instance['quran_random_id'];
			$quran_random_view_ar = $instance['quran_random_view_ar'];
			$quran_random_allow_by_sora = $instance['quran_random_allow_by_sora'];
			$quran_random_by_sora = $instance['quran_random_by_sora'];
		}else{
			$title = __( 'Quran Random', 'quran_gateway_widget' );
			$quran_random_id = 1;
			$quran_random_view_ar = 1;
			$quran_random_allow_by_sora = 0;
			$quran_random_by_sora = 1;
		}
		?>
		<p>
		<label for="<?php echo $this->get_field_id( 'title' ); ?>"><?php _e( 'Title:' ); ?></label> 
		<input class="widefat" id="<?php echo $this->get_field_id( 'title' ); ?>" name="<?php echo $this->get_field_name( 'title' ); ?>" type="text" value="<?php echo esc_attr( $title ); ?>" />
		</p>
		
		<p>
		<select id="<?php echo $this->get_field_id('quran_random_id'); ?>" name="<?php echo $this->get_field_name('quran_random_id'); ?>">
			<option value="1"<?php if($quran_random_id==1){ echo ' selected="selected"'; }?>>English</option>
			<option value="2"<?php if($quran_random_id==2){ echo ' selected="selected"'; }?>>French</option>
			<option value="3"<?php if($quran_random_id==3){ echo ' selected="selected"'; }?>>German</option>
		</select>
		<label for="<?php echo $this->get_field_id('quran_random_id'); ?>"> 
		<?php _e('Languages', 'quran_gateway_widget'); ?>
		</label>
		</p>

					<p>
					<select id="<?php echo $this->get_field_id('quran_random_allow_by_sora'); ?>" name="<?php echo $this->get_field_name('quran_random_allow_by_sora'); ?>">
					<option value="1"<?php if($quran_random_allow_by_sora==1){ echo ' selected="selected"'; }?>>Yes</option>
					<option value="0"<?php if($quran_random_allow_by_sora==0){ echo ' selected="selected"'; }?>>No</option>
					</select> <label for="<?php echo $this->get_field_id('quran_random_allow_by_sora'); ?>">Allow random by sora</label><br />
					
					<select id="<?php echo $this->get_field_id('quran_random_by_sora'); ?>" name="<?php echo $this->get_field_name('quran_random_by_sora'); ?>">
					<?php
					global $sora_en;
					for($i=1; $i < count($sora_en); ++$i){
					if($quran_random_by_sora==$i){
					echo '<option value="'.$i.'" selected="selected">'.$i.'. '.$sora_en[$i].'</option>';
					}else{
					echo '<option value="'.$i.'">'.$i.'. '.$sora_en[$i].'</option>';
					}
					}
					?>
					</select> <label for="<?php echo $this->get_field_id('quran_random_by_sora'); ?>">Select sora</label>
					</p>
		<p>
		<select id="<?php echo $this->get_field_id('quran_random_view_ar'); ?>" name="<?php echo $this->get_field_name('quran_random_view_ar'); ?>">
			<option value="1"<?php if($quran_random_view_ar==1){ echo ' selected="selected"'; }?>>Show</option>
			<option value="0"<?php if($quran_random_view_ar==0){ echo ' selected="selected"'; }?>>Hidden</option>
		</select>
		<label for="<?php echo $this->get_field_id( 'quran_random_view_ar' ); ?>"><?php _e( 'View arabic text:' ); ?></label>
		</p>
		<?php 
	}

	public function update( $new_instance, $old_instance ) {
		$instance = array();
		$instance['title'] = ( ! empty( $new_instance['title'] ) ) ? strip_tags( $new_instance['title'] ) : '';
		$instance['quran_random_id'] = $new_instance['quran_random_id'];
		$instance['quran_random_view_ar'] = $new_instance['quran_random_view_ar'];
		$instance['quran_random_allow_by_sora'] = $new_instance['quran_random_allow_by_sora'];
		$instance['quran_random_by_sora'] = $new_instance['quran_random_by_sora'];
		return $instance;
	}

}

function register_Quran_Gateway_Widget() {
    register_widget( 'Quran_Gateway_Widget' );
}
add_action( 'widgets_init', 'register_Quran_Gateway_Widget' );
?>